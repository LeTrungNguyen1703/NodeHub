# NoteHub

[![Vietnamese](https://img.shields.io/badge/Language-Vietnamese-red.svg)](README.md)

**NoteHub** is an effective team collaboration platform that helps team members collaborate and manage tasks easily. The project is built with modern architecture, ensuring scalability and high performance.

---

## ğŸš€ Project Overview

NoteHub is a modern web application designed to optimize teamwork processes and project management. The system provides a centralized platform helping team members easily collaborate, share information, and track work progress.

### Key Features:
*   **User Management & Secure Authentication**: SSO (Single Sign-On) system integrating Keycloak with Google OAuth login capability.
*   **Flexible Authorization**: Role-Based Access Control (RBAC) ensures data security.
*   **Modern User Interface**: Friendly UI/UX built with React 19, Mantine UI, and TailwindCSS.
*   **Modulith Architecture**: Backend designed with Spring Modulith ensuring modularity, maintainability, and scalability.
*   **Media Resource Management**: Integrated Cloudinary for optimal storage and processing of images and videos.
*   **Real-time Communication**: WebSocket support for real-time features.
*   **API Documentation**: Automatically generated API documentation using Swagger/OpenAPI.

---

## ğŸ›  Tech Stack

The project uses the most advanced technologies available today to ensure high performance and scalability:

### Backend
*   **Language**: Java 21 (LTS)
*   **Main Framework**: Spring Boot 3.5.9
*   **Architecture**: Spring Modulith 1.4.6 (Modular Monolith Architecture)
*   **Database**: MySQL 8.0
*   **ORM**: Spring Data JPA / Hibernate
*   **Security**:
    *   Spring Security
    *   OAuth2 Resource Server
    *   Keycloak 26.5 (Identity & Access Management)
*   **Database Migration**: Flyway
*   **Object Mapping**: MapStruct 1.6.3
*   **API Documentation**: SpringDoc OpenAPI 2.8.15 (Swagger UI)
*   **Cloud Storage**: Cloudinary (Image & Video Management)
*   **Email**: Spring Mail
*   **Real-time**: WebSocket Support

### Frontend
*   **Framework**: React 19.2.0 (Latest)
*   **Language**: TypeScript
*   **Build Tool**: Vite
*   **UI Framework**: Mantine UI 8.3.12 (Complete component library)
*   **Styling**: TailwindCSS 4.1.18
*   **HTTP Client**: Axios 1.13.2
*   **State Management**: React Query (TanStack Query)
*   **API Client Generation**: Orval (Auto-generated from OpenAPI)
*   **Authentication**: react-oidc-context 3.3.0
*   **Routing**: React Router 7.12.0
*   **Rich Text Editor**: Tiptap 3.15.3
*   **Charts**: Recharts 3.6.0

### Infrastructure & DevOps
*   **Containerization**: Docker & Docker Compose
*   **Identity Provider**: Keycloak 26.5
*   **Testing**:
    *   JUnit 5
    *   Testcontainers
    *   Spring Modulith Tests

---

## ğŸ“‚ Project Structure

```
NodeHub/
â”œâ”€â”€ src/                          # Backend Source Code (Java)
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/                # Main Source Code
â”‚   â”‚   â”‚   â””â”€â”€ com/modulith/auctionsystem/
â”‚   â”‚   â”‚       â”œâ”€â”€ AuctionSystemApplication.java    # Application Entry Point
â”‚   â”‚   â”‚       â”œâ”€â”€ common/                          # Shared components (Config, Models, Utils)
â”‚   â”‚   â”‚       â””â”€â”€ users/                           # User module (Modulith architecture)
â”‚   â”‚   â””â”€â”€ resources/           # Configuration files & Resources
â”‚   â”‚       â”œâ”€â”€ application.yml  # Main configuration file
â”‚   â”‚       â””â”€â”€ db/migration/    # Flyway migration scripts (SQL)
â”‚   â””â”€â”€ test/                    # Test Code
â”‚       â”œâ”€â”€ java/                # Unit & Integration Tests
â”‚       â””â”€â”€ resources/           # Test configurations
â”‚
â”œâ”€â”€ frontend/                    # Frontend Source Code (React + TypeScript)
â”‚   â”œâ”€â”€ src/                    # Main Source Code
â”‚   â”‚   â”œâ”€â”€ components/         # Reusable UI components
â”‚   â”‚   â”œâ”€â”€ pages/              # Page components (Routes)
â”‚   â”‚   â”œâ”€â”€ auth/               # Authentication logic & OIDC config
â”‚   â”‚   â”œâ”€â”€ middlewares/        # Route guards & middleware
â”‚   â”‚   â”œâ”€â”€ assets/             # Static assets (images, icons)
â”‚   â”‚   â”œâ”€â”€ api.ts              # API client (auto-generated by Orval)
â”‚   â”‚   â””â”€â”€ main.tsx            # React app entry point
â”‚   â”œâ”€â”€ public/                 # Public static files
â”‚   â”‚   â”œâ”€â”€ callback.html       # OIDC callback page
â”‚   â”‚   â””â”€â”€ silent-check-sso.html  # Silent SSO refresh
â”‚   â”œâ”€â”€ package.json            # Frontend dependencies
â”‚   â”œâ”€â”€ vite.config.ts          # Vite configuration
â”‚   â”œâ”€â”€ orval.config.ts         # Orval API generator config
â”‚   â””â”€â”€ tsconfig.json           # TypeScript configuration
â”‚
â”œâ”€â”€ docker-data/                # Docker persistent data (auto-generated)
â”‚   â”œâ”€â”€ mysql_data/             # MySQL database files
â”‚   â””â”€â”€ keycloak/               # Keycloak data
â”‚
â”œâ”€â”€ keycloak-config/            # Keycloak configuration
â”‚   â””â”€â”€ realm-export.json       # Realm configuration (users, clients, roles)
â”‚
â”œâ”€â”€ keycloak-theme/             # Custom Keycloak theme
â”‚   â””â”€â”€ keycloak-theme-for-kc-all-other-versions.jar
â”‚
â”œâ”€â”€ gradle/                     # Gradle wrapper files
â”œâ”€â”€ build.gradle                # Backend dependencies & build configuration
â”œâ”€â”€ settings.gradle             # Gradle project settings
â”œâ”€â”€ compose.yaml                # Docker Compose configuration
â”œâ”€â”€ Dockerfile                  # Backend Docker image definition
â””â”€â”€ README.md                   # Project Documentation (this file)
```

### Key Directories Explanation:

*   **`src/main/java/`**: Contains all Backend business logic. The project uses **Spring Modulith** architecture, modules are organized independently (e.g., `users`, `common`).
*   **`src/main/resources/db/migration/`**: Flyway migration scripts for database schema versioning.
*   **`frontend/src/`**: React application source code, including components, pages, authentication logic.
*   **`frontend/src/auth/`**: Handles login logic, OAuth2/OIDC with Keycloak.
*   **`docker-data/`**: This directory contains persistent data for Docker containers (MySQL, Keycloak). **Do not commit to Git**.
*   **`keycloak-config/realm-export.json`**: Keycloak realm configuration file (users, clients, roles) - automatically imported on first startup.

---

## âœ… Prerequisites

Before starting, ensure your machine has the following installed:

*   **Docker & Docker Compose:** Required (to run Backend and Database).
*   **Node.js:** Version 20 or higher (Bun or npm recommended) - For Frontend Developers.
*   **Java Development Kit (JDK):** Version 21 - Only needed if you want to develop Backend.
*   **Git:** For source code management.

---

## âš™ï¸ Installation & Configuration

### 1. Clone the project
```bash
git clone <repository-url>
cd NodeHub
```

### 2. Config environment variables

**Important**: Before running the application, you must configure environment variables.

### Create `.env` file from template
Project includes a sample `.env.example` file, please copy and edit it:
```bash
# Copy the sample file
copy .env.example .env

# After that, edit the .env file with your actual information
```
### 3. Install Dependencies

#### Frontend (Required for Frontend Developers)
```bash
cd frontend
npm install

# Or if using Bun (faster)
bun install
```

#### Backend (Only for Backend Developers)
If you only work on Frontend, you can **skip this step** as Backend will run via the available Docker Image.

```bash
# Build project (skip tests for faster build)
./gradlew build -x test

# Or build with tests
./gradlew build
```

---

## â–¶ï¸ How to Run

### Option 1: Run the entire system using Docker (Recommended for Frontend Team)

This is the **simplest way** to run the project. The Backend is already packaged on Docker Hub, you just need to pull and run.

#### Step 1: Start the entire system
```bash
docker-compose up -d
```

This command will automatically:
*   Pull Backend image from Docker Hub (if not present)
*   Start MySQL database
*   Start Keycloak (Identity Provider)
*   Start Backend application

**Check container status:**
```bash
docker-compose ps
```

Services will run at:
*   **Backend API**: http://localhost:8080
*   **Swagger UI (API Docs)**: http://localhost:8080/swagger-ui/index.html
*   **Keycloak Admin Console**: http://localhost:8180
    *   Username: `admin`
    *   Password: `admin` (or as configured in `.env`)

#### Step 2: Run Frontend
Open a new terminal and run:
```bash
cd frontend
npm run dev

# Or with Bun
bun run dev
```

âœ… **Access the application at**: http://localhost:5173

---

### Option 2: Run Development Environment (For Backend Team)

Use this method when you need to **edit Backend code** and want to test immediately.

#### Step 1: Start Infrastructure (MySQL + Keycloak)
```bash
docker-compose up -d mysql keycloak
```

Wait about 30-60 seconds for services to fully start.

#### Step 2: Run Backend locally
```bash
# Run with Gradle wrapper
./gradlew bootRun

# Or if already built
java -jar build/libs/*.jar
```

Backend will run at: http://localhost:8080

#### Step 3: Run Frontend
```bash
cd frontend
npm run dev
```

Frontend will run at: http://localhost:5173

---

### Useful Docker Commands

```bash
# View logs of all services
docker-compose logs -f

# View logs of a specific service
docker-compose logs -f backend
docker-compose logs -f mysql
docker-compose logs -f keycloak

# Stop all services
docker-compose down

# Stop and remove all data (careful!)
docker-compose down -v

# Restart a specific service
docker-compose restart backend

# Rebuild Backend image (if changes made)
docker-compose build backend
```

---

## â“ Troubleshooting

### 1. **Docker image pull error**
**Symptom:**
```
Error response from daemon: pull access denied for xxx/note-backend
```

**Solution:**
*   Check `DOCKER_HUB_USERNAME` and `DOCKER_HUB_REPO` variables in `.env` file.
*   Ensure the image has been pushed to Docker Hub.
*   If the repository is private, login to Docker Hub first:
  ```bash
  docker login
  ```

---

### 2. **Port Conflict Error**
**Symptom:**
```
Bind for 0.0.0.0:8080 failed: port is already allocated
```

**Solution:**

**Method 1: Change port in `.env`**
```env
MYSQL_LOCAL_PORT=3307  # Instead of 3306
BACKEND_PORT=8081       # Instead of 8080
KEYCLOAK_PORT=8181      # Instead of 8180
```

**Method 2: Find and kill process occupying port (Windows)**
```powershell
# Check process using port 8080
netstat -ano | findstr :8080

# Kill process (replace <PID> with found process ID)
taskkill /PID <PID> /F
```

**Method 3: Find and kill process (Linux/Mac)**
```bash
# Check process
lsof -i :8080

# Kill process
kill -9 <PID>
```

---

### 3. **Database Connection Error**
**Symptom:**
```
Communications link failure
Unable to connect to MySQL
```

**Solution:**
*   Ensure MySQL container is running:
  ```bash
  docker-compose ps mysql
  ```
*   Check MySQL logs:
  ```bash
  docker-compose logs mysql
  ```
*   Restart MySQL container:
  ```bash
  docker-compose restart mysql
  ```
*   If error persists, delete data and restart:
  ```bash
  docker-compose down -v
  docker-compose up -d
  ```

---

### 4. **Frontend cannot connect to Backend API**
**Symptom:**
*   `Network Error` or `CORS Error` in browser console
*   API calls return 404 or no response

**Solution:**
*   Check if Backend is running: http://localhost:8080
*   Check API base URL configuration in `frontend/src/axios.config.ts`
*   Check CORS configuration in Backend (`application.yml`)
*   Clear browser cache and restart Frontend:
  ```bash
  # In frontend directory
  rm -rf node_modules/.vite
  npm run dev
  ```

---

### 5. **Keycloak Authentication Error (Login failed)**
**Symptom:**
*   Redirect loop when logging in
*   `Invalid redirect_uri` error
*   Token expired immediately

**Solution:**
*   Check if Keycloak is started: http://localhost:8180
*   Ensure `realm-export.json` has been imported (check Keycloak logs)
*   Check OIDC configuration in `frontend/src/auth/oidc.config.ts`
*   Verify redirect URIs in Keycloak Admin Console:
    *   Login: http://localhost:5173/* or http://localhost:5173/callback.html
    *   Web Origins: http://localhost:5173
*   Clear browser cookies/session and try again

---

### 6. **Frontend Build Error**
**Symptom:**
```
Module not found
TypeScript compilation errors
```

**Solution:**
```bash
# Delete node_modules and reinstall
cd frontend
rm -rf node_modules
rm package-lock.json  # or bun.lock
npm install

# Clear cache
npm cache clean --force

# If using Bun
rm -rf node_modules
rm bun.lock
bun install
```

---

### 7. **Backend Build Error (Gradle)**
**Symptom:**
```
Compilation failed
Could not resolve dependencies
```

**Solution:**
```bash
# Clean and rebuild
./gradlew clean build

# Clear Gradle cache (if needed)
rm -rf ~/.gradle/caches/

# Rebuild
./gradlew build --refresh-dependencies
```

---

### 8. **Docker Compose cannot find `.env` file**
**Symptom:**
```
WARNING: The MYSQL_PASSWORD variable is not set
```

**Solution:**
*   Ensure `.env` file is in the **root directory** of the project (same level as `compose.yaml`)
*   Check filename is exactly `.env` (not `.env.txt` or `.env.example`)
*   Restart Docker Compose after creating `.env` file:
  ```bash
  docker-compose down
  docker-compose up -d
  ```

---

### 9. **Cloudinary upload not working**
**Symptom:**
*   Image upload failed
*   `401 Unauthorized` when uploading

**Solution:**
*   Check credentials in `.env`:
  ```env
  CLOUDINARY_CLOUD_NAME=your_cloud_name
  CLOUDINARY_API_KEY=your_api_key
  CLOUDINARY_API_SECRET=your_api_secret
  ```
*   Ensure info from [Cloudinary Dashboard](https://cloudinary.com/console) is correct
*   Restart Backend after updating `.env`

---

### 10. **Database migration failed (Flyway)**
**Symptom:**
```
Migration checksum mismatch
Flyway validation failed
```

**Solution:**
*   **Development Environment**: Reset database
  ```bash
  docker-compose down -v
  docker-compose up -d
  ```
*   **Production Environment**: Use Flyway repair (careful!)
  ```bash
  ./gradlew flywayRepair
  ```

---

### ğŸ†˜ Still having issues?

If the above solutions do not resolve the issue:

1. **Check detailed logs:**
   ```bash
   # Backend logs
   docker-compose logs -f backend

   # All services
   docker-compose logs -f
   ```

2. **Check tool versions:**
   ```bash
   docker --version
   docker-compose --version
   node --version
   java --version
   ```

3. **Restart the entire system:**
   ```bash
   docker-compose down
   docker-compose up -d
   ```

4. **Contact team leader** or create an issue on the repository with full information:
   *   Detailed error description
   *   Error logs
   *   Steps tried
   *   Environment (OS, versions)

---

## ğŸ“š Additional Documentation

*   **API Documentation (Swagger)**: http://localhost:8080/swagger-ui/index.html
*   **Keycloak Admin Console**: http://localhost:8180/admin
*   **Spring Modulith Documentation**: https://docs.spring.io/spring-modulith/reference/
*   **React Router v7**: https://reactrouter.com/
*   **Mantine UI**: https://mantine.dev/

---

**Happy Coding! ğŸš€**
